<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
  <title>직원_내 정보</title>
  <th:block layout:fragment="css">
    <style>
      .info-table { table-layout: fixed; border-collapse: collapse; width:600px; margin: 0; }
      .info-table th, .info-table td { border:1px solid #e5e7eb; padding:10px; vertical-align:top; }
      .info-table th { width:160px; background:#fafafa; text-align:left; font-weight: 600; }
      .btn-bar { display: flex; justify-content: flex-start; gap: 10px; width: 600px; margin: 20px 0 0 0; }
      
      /* 비밀번호 변경 폼 스타일 */
      .password-change-form {
        display: none;
        margin-top: 30px;
        padding-top: 30px;
        border-top: 1px solid #ddd;
        width: 600px;
      }
      .password-change-form input[type="password"] {
        width: 100%;
        box-sizing: border-box;
        height: 36px;
        padding: 0 10px;
        border: 1px solid #cbd5e1;
        border-radius: 6px;
      }
      .password-change-form .btn-bar {
        justify-content: flex-end;
      }
    </style>
  </th:block>
</head>

<div layout:fragment="content">
    <div class="basic-N23" data-bid="wWM47SwZLN">
      <div class="contents-inner">
        <div class="contents-container container-md">
          <div class="textset" style="margin-bottom: 30px;">
            <img class="imageset-img" src="/resources/images/img_basic_N23_1.png" alt="이미지">
            <h2 class="textset-tit">내 정보</h2>
            <p class="textset-desc">로그인한 직원의 상세 정보입니다.</p>
            <div th:if="${message}" class="alert" th:text="${message}" style="background:#e0f7fa;color:#00796b;border:1px solid #b2ebf2;padding:10px 12px;border-radius:6px;margin-top:10px;"></div>
            <div th:if="${error}" class="alert" th:text="${error}" style="background:#ffebee;color:#c62828;border:1px solid #ef9a9a;padding:10px 12px;border-radius:6px;margin-top:10px;"></div>
          </div>

          <table class="info-table">
            <tbody>
              <tr><th>직원번호</th><td th:text="${employeeCommand.empNum}"></td></tr>
              <tr><th>아이디</th><td th:text="${employeeCommand.empId}"></td></tr>
              <tr><th>이름</th><td th:text="${employeeCommand.empName}"></td></tr>
              <tr><th>주민번호</th><td th:text="${employeeCommand.empJumin}"></td></tr>
              <tr><th>연락처</th><td th:text="${employeeCommand.empPhone}"></td></tr>
              <tr><th>이메일</th><td th:text="${employeeCommand.empEmail}"></td></tr>
              <tr><th>주소</th>
                <td>
                  <ul style="margin:0; padding-left:0; list-style:none;">
                    <li th:text="${employeeCommand.empAddr}"></li>
                    <li th:text="${employeeCommand.empAddrDetail}"></li>
                    <li>우편번호: <span th:text="${employeeCommand.empPost}"></span></li>
                  </ul>
                </td>
              </tr>
              <tr><th>입사일</th><td th:text="${#dates.format(employeeCommand.empHireDate, 'yyyy-MM-dd')}"></td></tr>
            </tbody>
          </table>

          <div class="btn-bar">
            <button type="button" id="changePwBtn" class="btnset btnset-line btnset-round">비밀번호 변경</button>
            <a th:href="@{/employee/{num}/edit(num=${employeeCommand.empNum})}" class="btnset btnset-line btnset-round">직원 수정</a>
          </div>

          <div id="passwordChangeForm" class="password-change-form">
            <form th:action="@{/employee/my-page/change-password}" method="post" onsubmit="return confirmChangePassword();">
              <table class="info-table">
                <tbody>
                  <tr><th>현재 비밀번호</th><td><input type="password" name="oldPw" required></td></tr>
                  <tr><th>새 비밀번호</th><td><input type="password" name="newPw" required></td></tr>
                  <tr><th>새 비밀번호 확인</th><td><input type="password" name="newPwCon" required></td></tr>
                </tbody>
              </table>
              <div class="btn-bar">
                <button type="submit" class="btnset btnset-round">비밀번호 변경 완료</button>
              </div>
            </form>
          </div>

        </div>
      </div>
    </div>
</div>
<th:block layout:fragment="script">
<script>
  $(function() {
    $('#changePwBtn').on('click', function() {
      $('#passwordChangeForm').slideToggle(200);
    });
  });

  function confirmChangePassword() {
    const newPw = document.querySelector('input[name="newPw"]').value;
    const newPwCon = document.querySelector('input[name="newPwCon"]').value;
    
    if (newPw !== newPwCon) {
      alert("새 비밀번호와 비밀번호 확인이 일치하지 않습니다.");
      return false;
    }
    
    return confirm("정말 비밀번호를 변경하시겠습니까?\n변경 후에는 자동으로 로그아웃됩니다.");
  }
</script>
</th:block>
</html>