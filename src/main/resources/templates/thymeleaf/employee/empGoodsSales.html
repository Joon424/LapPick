<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
    <title>관리자 - 판매 현황</title>
    <th:block layout:fragment="css">
        <style>
            .item-table { table-layout: fixed; width: 100%; border-collapse: collapse; }
            .item-table th, .item-table td { vertical-align: middle; padding: 12px 8px; border-bottom: 1px solid #eee; text-align: center; }
            .item-table thead tr { background: #f9fafb; }
            .item-table .text-start { text-align: left; }
            .sortable-th { cursor: pointer; position: relative; padding: 0 !important; -webkit-user-select: none; -ms-user-select: none; user-select: none; }
            .sortable-th:hover { background-color: #f0f2f5; }
            .sortable-th.active-sort { background-color: #e9ecef; font-weight: 600; color: #007bff; }
            .sortable-th a { display: flex; align-items: center; justify-content: center; gap: 6px; color: inherit; text-decoration: none; width: 100%; height: 100%; padding: 12px 8px; box-sizing: border-box; }
            .sort-icon { font-size: 1.2em; line-height: 1; opacity: 0.5; }
            .active-sort .sort-icon { opacity: 1; }
            .pagination-container { display:flex; gap:6px; justify-content:center; align-items:center; margin-top:20px; }
            .page-btn { display: inline-block; min-width: 32px; padding: 6px 10px; font-size: 13px; font-weight: 500; text-align: center; text-decoration: none; color: #333; background-color: #fff; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; }
            .page-btn:hover { background-color: #f5f5f5; }
            .page-btn.active { background-color: #333; color: #fff; border-color: #333; font-weight: bold; }
        </style>
    </th:block>
</head>
<body>
<div layout:fragment="content">
    <main class="th-layout-main">
        <div class="basic-N23" data-bid="empGoodsSales">
            <div class="contents-inner">
                <div class="contents-container container-md">
                    <div class="textset" style="margin-bottom:14px;">
                        <img class="imageset-img" src="/resources/images/img_basic_N23_1.png" alt="이미지">
                        <h2 class="textset-tit">상품 판매 현황</h2>
                        <p class="textset-desc">상품별 누적 판매량, 판매액, 리뷰 통계를 확인합니다.</p>
                    </div>

                    <div style="display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin:10px 0 16px;">
                        <form th:action="@{/goods/admin/sales-status}" method="get" style="display:flex; gap:8px; align-items:center;">
                            <input type="hidden" name="sortBy" th:value="${sortBy}">
                            <input type="hidden" name="sortDir" th:value="${sortDir}">
                            <input type="text" name="searchWord" th:value="${searchWord}" placeholder="상품명 검색" style="height:36px; padding:0 10px; border:1px solid #cbd5e1; border-radius:6px; min-width:240px;">
                            <button type="submit" class="btnset btnset-line btnset-round">검색</button>
                            <a class="btnset btnset-line btnset-round" th:href="@{/goods/admin/sales-status}">전체보기</a>
                        </form>
                        <div>
                            <a th:href="@{/goods/list}" class="btnset btnset-line btnset-round">상품 목록</a>
                        </div>
                    </div>

                    <table class="item-table">
                        <thead>
                            <tr>
                                <th style="width: 15%;">상품번호</th>
                                <th style="width: 25%;">상품명</th>
                                <th class="sortable-th" th:classappend="${sortBy == 'sales'} ? 'active-sort'">
                                    <a class="sort-link" th:href="@{/goods/admin/sales-status(sortBy='sales', sortDir=${(sortBy == 'sales' and sortDir == 'desc') ? 'asc' : 'desc'}, searchWord=${searchWord})}">
                                        <span>판매갯수</span>
                                        <span class="sort-icon" th:if="${sortBy == 'sales'}" th:text="${sortDir == 'desc' ? '▼' : '▲'}"></span>
                                    </a>
                                </th>
                                <th class="sortable-th" th:classappend="${sortBy == 'amount'} ? 'active-sort'">
                                    <a class="sort-link" th:href="@{/goods/admin/sales-status(sortBy='amount', sortDir=${(sortBy == 'amount' and sortDir == 'desc') ? 'asc' : 'desc'}, searchWord=${searchWord})}">
                                        <span>총 판매액</span>
                                        <span class="sort-icon" th:if="${sortBy == 'amount'}" th:text="${sortDir == 'desc' ? '▼' : '▲'}"></span>
                                    </a>
                                </th>
                                <th class="sortable-th" th:classappend="${sortBy == 'reviews'} ? 'active-sort'">
                                    <a class="sort-link" th:href="@{/goods/admin/sales-status(sortBy='reviews', sortDir=${(sortBy == 'reviews' and sortDir == 'desc') ? 'asc' : 'desc'}, searchWord=${searchWord})}">
                                        <span>리뷰갯수</span>
                                        <span class="sort-icon" th:if="${sortBy == 'reviews'}" th:text="${sortDir == 'desc' ? '▼' : '▲'}"></span>
                                    </a>
                                </th>
                                <th class="sortable-th" th:classappend="${sortBy == 'rating'} ? 'active-sort'">
                                    <a class="sort-link" th:href="@{/goods/admin/sales-status(sortBy='rating', sortDir=${(sortBy == 'rating' and sortDir == 'desc') ? 'asc' : 'desc'}, searchWord=${searchWord})}">
                                        <span>평균 평점</span>
                                        <span class="sort-icon" th:if="${sortBy == 'rating'}" th:text="${sortDir == 'desc' ? '▼' : '▲'}"></span>
                                    </a>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:if="${pageData == null or #lists.isEmpty(pageData.items)}"><td colspan="6" style="padding:40px 0;">판매 현황 데이터가 없습니다.</td></tr>
                            <tr th:each="item : ${pageData.items}">
                                <td th:text="${item.goodsNum}"></td>
                                <td class="text-start" th:text="${item.goodsName}"></td>
                                <td th:text="${#numbers.formatInteger(item.totalSoldQty, 0, 'COMMA')}"></td>
                                <td th:text="${#numbers.formatInteger(item.totalSalesAmount, 0, 'COMMA')} + '원'"></td>
                                <td th:text="${item.reviewCount}"></td>
                                <td th:text="${#numbers.formatDecimal(item.avgRating, 1, 1)}"></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="pagination-container" th:if="${pageData != null}">
                        <a class="page-btn" th:href="@{/goods/admin/sales-status(page=${pageData.startPage - 1}, searchWord=${searchWord}, sortBy=${sortBy}, sortDir=${sortDir})}" th:if="${pageData.startPage > 1}">이전</a>
                        <a class="page-btn" th:each="i : ${#numbers.sequence(pageData.startPage, pageData.endPage)}" th:text="${i}"
                           th:classappend="${pageData.page == i} ? 'active' : ''"
                           th:href="@{/goods/admin/sales-status(page=${i}, searchWord=${searchWord}, sortBy=${sortBy}, sortDir=${sortDir})}"></a>
                        <a class="page-btn" th:href="@{/goods/admin/sales-status(page=${pageData.endPage + 1}, searchWord=${searchWord}, sortBy=${sortBy}, sortDir=${sortDir})}" th:if="${pageData.endPage < pageData.totalPages}">다음</a>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>
<th:block layout:fragment="script">
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        const scrollPosition = sessionStorage.getItem('scrollPosition');
        if (scrollPosition) {
            window.scrollTo(0, parseInt(scrollPosition, 10));
            sessionStorage.removeItem('scrollPosition');
        }

        const sortLinks = document.querySelectorAll('.sort-link');
        sortLinks.forEach(function(link) {
            link.addEventListener('click', function() {
                sessionStorage.setItem('scrollPosition', window.scrollY);
            });
        });
    });
    </script>
</th:block>
</body>
</html>