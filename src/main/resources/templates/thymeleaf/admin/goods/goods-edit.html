<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{../layout/default}">
<head>
  <title>직원_상품수정</title>
  <th:block layout:fragment="css">
    <style>
      table { table-layout: fixed; border-collapse: collapse; width: 800px; }
      th, td { border:1px solid #e5e7eb; padding:12px 15px; vertical-align: top; }
      th { width:160px; background:#fafafa; text-align:left; font-weight: 600; }
      .btnbar { display:flex; align-items:center; gap:10px; margin-top:16px; justify-content:flex-start; }
      input[type="text"], input[type="number"], input[type="file"], select, textarea {
        width:100%; box-sizing:border-box; padding:8px; border:1px solid #d1d5db; border-radius:6px; font-size:14px;
      }
      textarea { resize: vertical; min-height: 120px; }
      .hint { color:#777; font-size:12px; margin-top:4px; }
      .error-message { color: red; font-size: 12px; margin-top: 4px; }
    </style>
  </th:block>
</head>
<body>
<div layout:fragment="content">
  <main class="th-layout-main">
    <div class="basic-N23" data-bid="wWM47SwZLN">
      <div class="contents-inner">
        <div class="contents-container container-md">

          <div class="textset">
            <img class="imageset-img" src="/resources/images/img_basic_N23_1.png" alt="이미지">
            <h2 class="textset-tit">상품 정보 수정</h2>
            <p class="textset-desc">기존 상품의 상세 정보를 수정하는 페이지입니다.</p>
          </div>

         <form id="goodsEditForm" th:action="@{/admin/goods/update}" th:object="${goodsCommand}" method="post" enctype="multipart/form-data" autocomplete="off">
            <input type="hidden" th:field="*{goodsNum}">

            <table>
              <tbody>
              <tr><th>상품번호</th><td th:text="*{goodsNum}"></td></tr>
              <tr><th>상품명</th><td><input type="text" th:field="*{goodsName}" required></td></tr>
              <tr><th>상품가격</th><td><input type="number" th:field="*{goodsPrice}" placeholder="숫자만 입력 (예: 1500000)" required></td></tr>
              <tr><th>현재 재고</th><td><span th:text="|${goodsCommand.stockQty != null ? goodsCommand.stockQty : 0}개|"></span><span class="hint" style="margin-left:10px;">(재고 변경은 상품 목록의 '재고' 버튼을 이용해주세요.)</span></td></tr>
              <tr>
                <th>브랜드</th>
                <td>
                  <select th:field="*{goodsBrand}">
                    <option value="">-- 브랜드 선택 --</option>
                    <option value="SAMSUNG">삼성전자</option>
                    <option value="LG">LG전자</option>
                    <option value="APPLE">Apple</option>
                    <option value="MSI">MSI</option>
                    <option value="ASUS">ASUS</option>
                    <option value="LENOVO">레노버</option>
                    <option value="MICROSOFT">마이크로소프트</option>
                    <option value="HP">HP</option>
                    <option value="HANSUNG">한성컴퓨터</option>
                  </select>
                </td>
              </tr>
              <tr>
                <th>용도</th>
                <td>
                  <select th:field="*{goodsPurpose}">
                    <option value="">-- 용도 선택 --</option>
                    <option value="OFFICE">사무/인강용</option>
                    <option value="GAMING">게이밍</option>
                    <option value="VIDEO_EDIT">영상/디자인 작업용</option>
                  </select>
                </td>
              </tr>
              <tr>
                <th>화면 크기 (인치)</th>
                <td>
                  <input type="text" id="goodsScreenSize" name="goodsScreenSize" 
                         th:value="*{goodsScreenSize != null ? #numbers.formatInteger(goodsScreenSize * 10, 0) : ''}"
                         placeholder="예: 15.6인치 -> 156 입력" 
                         inputmode="numeric" pattern="[0-9]*">
                  <div class="hint">소수점을 제외한 숫자만 입력하세요. (예: 15.6 -> 156 / 14.0 -> 140)</div>
                </td>
              </tr>
              <tr>
                <th>무게 (kg)</th>
                <td>
                  <input type="text" id="goodsWeight" name="goodsWeight" 
                         th:value="*{goodsWeight != null ? #numbers.formatInteger(goodsWeight * 100, 0) : ''}"
                         placeholder="예: 1.25kg -> 125 입력" 
                         inputmode="numeric" pattern="[0-9]*">
                  <div class="hint">소수점을 제외한 숫자(g)로 입력하세요. (예: 1.25 -> 125 / 0.99 -> 99)</div>
                </td>
              </tr>
              <tr>
                <th>상품설명</th>
                <td>
                  <textarea th:field="*{goodsContents}" placeholder="상품 상세 설명 (최상단에 표시됩니다)"></textarea>
                </td>
              </tr>
              <tr>
                <th>키워드</th>
                <td>
                  <div style="display:flex; gap:10px;">
                    <input type="text" th:field="*{goodsKeyword1}" placeholder="#키워드1 ('#' 없이 입력)">
                    <input type="text" th:field="*{goodsKeyword2}" placeholder="#키워드2 ('#' 없이 입력)">
                    <input type="text" th:field="*{goodsKeyword3}" placeholder="#키워드3 ('#' 없이 입력)">
                  </div>
                  <div class="hint">'#' 없이 내용만 입력해도 자동으로 #이 추가됩니다.</div>
                </td>
              </tr>
              <tr>
                <th>배송 정보</th>
                <td>
                  <input type="text" th:field="*{goodsShippingInfo}" placeholder="예: 999,000원 이상 무료배송 (미입력 시 기본값 자동 적용)">
                </td>
              </tr>
              <tr>
                <th>판매자 정보</th>
                <td>
                  <input type="text" th:field="*{goodsSellerInfo}" placeholder="예: LapPick (필수 입력)" required>
                  <div th:if="${#fields.hasErrors('goodsSellerInfo')}" th:errors="*{goodsSellerInfo}" class="error-message"></div>
                </td>
              </tr>
              <tr>
                <th>대표이미지 수정</th>
                <td>
                  <div th:if="${goodsCommand.goodsMainStoreImage != null}">
                    <b>현재 이미지:</b>
                    <img th:src="@{/upload/{img}(img=${goodsCommand.goodsMainStoreImage})}" alt="대표이미지" style="max-width: 150px; height: auto; display: block; margin-top: 5px;">
                  </div>
                  <div class="hint" style="margin:10px 0;">새 이미지로 변경하려면 아래에 파일을 등록하세요. (필수 아님)</div>
                  <input type="file" name="goodsMainImage" id="goodsMainImage">
                </td>
              </tr>
              <tr>
                <th>상세이미지(썸네일) 수정</th>
                <td>
                  <div th:if="*{goodsDetailStoreImage != null and goodsDetailStoreImage != ''}">
                    <b>현재 이미지 (삭제하려면 체크):</b>
                    <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top: 5px;">
                      <th:block th:each="img : ${#strings.listSplit(goodsCommand.goodsDetailStoreImage, '/')}" th:if="${img != goodsCommand.goodsMainStoreImage}">
                        <div th:if="${!img.isEmpty()}" style="text-align:center;">
                          <img th:src="@{/upload/{imgName}(imgName=${img})}" alt="상세이미지" style="max-width: 120px; height: auto;"><br>
                          <label><input type="checkbox" name="imagesToDelete" th:value="${img}"> 삭제</label>
                        </div>
                      </th:block>
                    </div>
                  </div>
                  <div class="hint" style="margin:10px 0;">새 이미지를 추가하려면 아래에 파일을 등록하세요. (최대 10개)</div>
                  <input type="file" name="goodsDetailImage" id="goodsDetailImage" multiple="multiple">
                </td>
              </tr>
              <tr>
                <th>상세 설명 이미지 수정</th>
                <td>
                  <div th:if="*{goodsDetailStore != null and goodsDetailStore != ''}">
                    <b>현재 이미지 (삭제하려면 체크):</b>
                    <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top: 5px;">
                      <div th:each="img : ${#strings.listSplit(goodsCommand.goodsDetailStore, '/')}" th:if="${!img.isEmpty()}" style="text-align:center;">
                          <img th:src="@{/upload/{imgName}(imgName=${img})}" alt="상세 설명 이미지" style="max-width: 120px; height: auto;"><br>
                          <label><input type="checkbox" name="detailDescImagesToDelete" th:value="${img}"> 삭제</label>
                      </div>
                    </div>
                  </div>
                  <div class="hint" style="margin:10px 0;">새 이미지를 추가하려면 아래에 파일을 등록하세요. (최대 5개)</div>
                  <input type="file" name="goodsDetail" id="goodsDetail" multiple="multiple">
                </td>
              </tr>
              </tbody>
            </table>
          </form>

          <div class="btnbar">
           <a class="btnset btnset-line btnset-round" th:href="@{/admin/goods}">목록으로</a>
            <button form="goodsEditForm" type="submit" class="btnset btnset-line btnset-round">수정완료</button>
          </div>

        </div>
      </div>
    </div>
  </main>
</div>
<th:block layout:fragment="script">
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // --- 파일 개수 제한 스크립트 ---
      const detailImageInput = document.getElementById('goodsDetailImage');
      const detailDescInput = document.getElementById('goodsDetail');
      const MAX_DETAIL_IMAGES = 10;
      const MAX_DETAIL_DESC = 5;

      detailImageInput.addEventListener('change', function(event) {
        if (event.target.files.length > MAX_DETAIL_IMAGES) {
          alert('상세이미지(썸네일)는 최대 ' + MAX_DETAIL_IMAGES + '개까지만 등록할 수 있습니다.');
          event.target.value = ''; // 파일 선택 초기화
        }
      });
      
      detailDescInput.addEventListener('change', function(event) {
        if (event.target.files.length > MAX_DETAIL_DESC) {
          alert('상세 설명 이미지는 최대 ' + MAX_DETAIL_DESC + '개까지만 등록할 수 있습니다.');
          event.target.value = ''; // 파일 선택 초기화
        }
      });
    });
  </script>
</th:block>
</body>
</html>