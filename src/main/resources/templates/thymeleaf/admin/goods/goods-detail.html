<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{../layout/default}">
<head>
  <title>직원_상품상세</title>
  <th:block layout:fragment="css">
    <style>
      table { table-layout: fixed; border-collapse: collapse; width: 800px; }
      th, td { border:1px solid #e5e7eb; padding:12px 15px; vertical-align: top; }
      th { width:160px; background:#fafafa; text-align:left; font-weight: 600; }
      .btnbar { display:flex; align-items:center; gap:10px; margin-top:16px; justify-content:flex-start; }
      
      .qty-plus { color: blue; font-weight: bold; }
      .qty-minus { color: red; font-weight: bold; }
	  .history-table { 
      	margin-top: 40px; 
      }
      .history-table .pagination-container {
      	width: 800px;
      }
      
      #historySection { 
      	display: none; 
      }
      
      .history-table h3 { margin-bottom: 10px; font-size: 1.5rem; }
      
      .pagination-container .page-btn {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          width: 32px; 
          height: 32px;
          padding: 0; 
          font-size: 13px;
          font-weight: 500;
          text-align: center;
          text-decoration: none;
          color: #555;
          background-color: #fff;
          border: 1px solid #ccc;
          border-radius: 4px;
          cursor: pointer;
          box-sizing: border-box;
          transition: background-color 0.2s, border-color 0.2s;
      }
      .page-btn:not(.active):not(.disabled):hover {
          background-color: #f0f0f0;
          border-color: #bbb;
      }
      .pagination-container .page-btn.active {
          background-color: #333;
          color: #fff;
          border-color: #333;
          font-weight: bold;
          cursor: default;
      }
      .pagination-container .page-btn.disabled {
          color: #bbb;
          border-color: #e0e0e0;
          cursor: default;
          background-color: #f9f9f9;
          pointer-events: none;
      }
      .pagination-container .page-btn.disabled:hover {
           background-color: #f9f9f9;
           border-color: #e0e0e0;
      }
    </style>
  </th:block>
</head>
<body>
<div layout:fragment="content">
  <main class="th-layout-main">
    <div class="basic-N23" data-bid="wWM47SwZLN">
      <div class="contents-inner">
        <div class="contents-container container-md">
          <div class="textset">
            <img class="imageset-img" src="/resources/images/img_basic_N23_1.png" alt="이미지">
            <h2 class="textset-tit">상품 상세 정보</h2>
            <p class="textset-desc">상품의 상세 정보를 보여주는 페이지입니다.</p>
            <div class="alert" th:if="${message != null or error != null}" th:text="${message != null ? message : error}"
                 style="background:#e0f7fa;color:#00796b;border:1px solid #b2ebf2;padding:10px 12px;border-radius:6px;margin-top:10px;"></div>
            </div>

          <table border="1">
            <tbody>
            <tr><th>상품번호</th><td th:text="${goodsCommand.goodsNum}"></td></tr>
            <tr><th>상품명</th><td th:text="${goodsCommand.goodsName}"></td></tr>
            <tr><th>가격</th><td th:text="${#numbers.formatInteger(goodsCommand.goodsPrice, 0, 'COMMA')} + '원'"></td></tr>
            <tr><th>현재 재고</th><td th:text="${goodsCommand.stockQty} + '개'"></td></tr>
            <tr><th>브랜드</th><td th:text="${goodsCommand.goodsBrand}"></td></tr>
            <tr><th>용도</th><td th:text="${goodsCommand.goodsPurpose}"></td></tr>
            <tr><th>화면 크기</th><td th:text="${goodsCommand.goodsScreenSize} + '인치'"></td></tr>
            <tr><th>무게</th><td th:text="${goodsCommand.goodsWeight} + 'kg'"></td></tr>
            <tr><th>상품설명</th><td style="white-space: pre-wrap;" th:text="${goodsCommand.goodsContents}"></td></tr>
            <tr>
              <th>키워드</th>
              <td th:text="|${goodsCommand.goodsKeyword1} ${goodsCommand.goodsKeyword2} ${goodsCommand.goodsKeyword3}|"></td>
            </tr>
            <tr><th>배송 정보</th><td th:text="${goodsCommand.goodsShippingInfo}"></td></tr>
            <tr><th>판매자 정보</th><td th:text="${goodsCommand.goodsSellerInfo}"></td></tr>
            <tr th:if="${goodsCommand.goodsMainStoreImage != null}">
              <th>대표이미지 (썸네일)</th>
              <td><img th:src="@{/upload/{img}(img=${goodsCommand.goodsMainStoreImage})}" alt="대표이미지" style="max-width: 300px; height: auto;"></td>
            </tr>
            <tr>
              <th>상세이미지 (썸네일)</th>
              <td>
                <div th:if="${goodsCommand.goodsDetailStoreImage != null and !#strings.isEmpty(goodsCommand.goodsDetailStoreImage)}" style="display:flex; flex-wrap:wrap; gap:10px;">
                  
                  <div th:each="img : ${#strings.listSplit(goodsCommand.goodsDetailStoreImage, '/')}"
                       th:if="${!img.isEmpty() and img != goodsCommand.goodsMainStoreImage}">
                    <img th:src="@{/upload/{imgName}(imgName=${img})}" alt="상세이미지" style="max-width: 200px; height: auto;">
                  </div>
                  
                </div>
                <p th:if="${goodsCommand.goodsDetailStoreImage == null or #strings.isEmpty(goodsCommand.goodsDetailStoreImage)}">
                  등록된 상세 이미지가 없습니다.
                </p>
              </td>
            </tr>
            <tr>
              <th>상세 설명 이미지</th>
              <td>
                <div th:if="${goodsCommand.goodsDetailStore != null and !#strings.isEmpty(goodsCommand.goodsDetailStore)}" style="display:flex; flex-direction: column; gap:10px;">
                  <div th:each="img : ${#strings.listSplit(goodsCommand.goodsDetailStore, '/')}">
                    <img th:if="${!img.isEmpty()}" th:src="@{/upload/{imgName}(imgName=${img})}" alt="상세 설명 이미지" style="max-width: 100%; height: auto;">
                  </div>
                </div>
                <p th:if="${goodsCommand.goodsDetailStore == null or #strings.isEmpty(goodsCommand.goodsDetailStore)}">
                  등록된 상세 설명 이미지가 없습니다.
                </p>
              </td>
            </tr>
            <tr>
              <th>등록일</th><td th:text="${#dates.format(goodsCommand.goodsDate, 'yyyy-MM-dd')}"></td>
            </tr>
            </tbody>
          </table>
          
		   <div id="action-bar" class="btnbar">
  <a th:href="@{/admin/goods}" class="btnset btnset-line btnset-round">목록으로</a>
  <a th:href="@{/admin/goods/{num}/edit(num=${goodsCommand.goodsNum})}" class="btnset btnset-line btnset-round">상품 수정</a>
  <button type="button" class="btnset btnset-line btnset-round" onclick="toggleHistory()">재고변경이력</button>
</div>
		  
          <div id="historySection" class="history-table" th:style="${showHistory} ? 'display:block;' : 'display:none;'">
            <h3>재고 변경 이력</h3>
            <table border="1">
              <thead>
                <tr style="background:#fafafa;">
                  <th style="width: 25%;">변경일</th>
                  <th style="width: 20%;">변경 수량</th>
                  <th>사유</th>
                </tr>
              </thead>
              <tbody>
                <tr th:if="${#lists.isEmpty(historyPageData.items)}">
                  <td colspan="3" style="text-align:center; color:#777; padding: 20px;">재고 변경 이력이 없습니다.</td>
                </tr>
                <tr th:each="history : ${historyPageData.items}">
                  <td th:text="${#dates.format(history.ipgoDate, 'yyyy-MM-dd HH:mm')}"></td>
                  <td>
                    <span th:if="${history.ipgoQty > 0}" class="qty-plus" th:text="'+' + ${history.ipgoQty}"></span>
                    <span th:if="${history.ipgoQty < 0}" class="qty-minus" th:text="${history.ipgoQty}"></span>
                  </td>
                  <td th:text="${history.ipgoMemo}"></td>
                </tr>
              </tbody>
            </table>
            <div class="pagination-container" style="display:flex; gap:6px; justify-content:center; align-items:center; margin-top:20px;"
                 th:if="${historyPageData.total > 0 and historyPageData.totalPages > 1}">
              
              <a class="page-btn"
                 th:href="${historyPageData.page > 1} ? @{/admin/goods/{num}(num=${goodsCommand.goodsNum}, historyPage=1, showHistory=true)} + '#historySection' : null"
                 th:classappend="${historyPageData.page <= 1} ? 'disabled' : ''">&lt;&lt;</a>
                 
              <a class="page-btn"
                 th:href="${historyPageData.page > 1} ? @{/admin/goods/{num}(num=${goodsCommand.goodsNum}, historyPage=${historyPageData.page - 1}, showHistory=true)} + '#historySection' : null"
                 th:classappend="${historyPageData.page <= 1} ? 'disabled' : ''">&lt;</a>
                 
              <a class="page-btn" th:each="p : ${#numbers.sequence(historyPageData.startPage, historyPageData.endPage)}" th:text="${p}"
                 th:classappend="${historyPageData.page == p} ? 'active' : ''"
                 th:href="@{/admin/goods/{num}(num=${goodsCommand.goodsNum}, historyPage=${p}, showHistory=true)} + '#historySection'"></a>
                 
              <a class="page-btn"
                 th:href="${historyPageData.page < historyPageData.totalPages} ? @{/admin/goods/{num}(num=${goodsCommand.goodsNum}, historyPage=${historyPageData.page + 1}, showHistory=true)} + '#historySection' : null"
                 th:classappend="${historyPageData.page >= historyPageData.totalPages} ? 'disabled' : ''">&gt;</a>
                 
              <a class="page-btn"
                 th:href="${historyPageData.page < historyPageData.totalPages} ? @{/admin/goods/{num}(num=${goodsCommand.goodsNum}, historyPage=${historyPageData.totalPages}, showHistory=true)} + '#historySection' : null"
                 th:classappend="${historyPageData.page >= historyPageData.totalPages} ? 'disabled' : ''">&gt;&gt;</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<th:block layout:fragment="script">
  <script th:inline="javascript">
    /*<![CDATA[*/
    // URL 쿼리 파라미터(showHistory=true)로 페이지 진입 시, 재고 이력 섹션을 바로 표시하기 위함입니다.
    const showHistoryOnLoad = /*[[${showHistory}]]*/ false;
    /*]]>*/

    document.addEventListener('DOMContentLoaded', function() {
        if (showHistoryOnLoad) {
            const historySection = document.getElementById('historySection');
            historySection.style.display = 'block';
        }
    });

    function toggleHistory() {
      const historySection = document.getElementById('historySection');
      if (historySection.style.display === 'none' || historySection.style.display === '') {
        historySection.style.display = 'block';
      } else {
        historySection.style.display = 'none';
      }
    }
  </script>
</th:block>
</body>
</html>